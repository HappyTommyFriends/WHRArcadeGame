using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class HighScoresController : MonoBehaviour
{
	public GameObject highScoresHolder;
	public SceneController sceneController;
	public SLAnimator slAnimator;
	public float animationDuration = 1.7f;
	public Alphabet alphabet;
	public float startX = -1f;
	public float startY = 1f;
	public float spacing = 0.14f;
	public int scorePixelWidth = 50;
	public int namePixelWidth = 40;
	public int centerSpacing = 110;
	public float titleY = -1.1f;
	
	protected static string[] names = { "Silas", "Doomn", "DrSci", "edd!e", "Geetz", "Jon", "PStu", "SL", "tomas" };
	protected static int[] scores = { 1000, 500, 500, 500, 500, 500, 500, 500, 500 };
	
    // Start is called before the first frame update
    void Start()
    {
		buildScoresDisplay();
        slAnimator.Animate(highScoresHolder, highScoresHolder.transform.position, Vector3.zero, animationDuration);
		addHighScore(600);
	}
	
	void buildScoresDisplay() {
		clearChildren();
		GameObject highScoresWord = alphabet.WordObject(" High Scores ");
		highScoresWord.transform.parent = highScoresHolder.transform;
		highScoresWord.transform.localPosition = new Vector3(-0.24f, titleY, 0);
		float currentY = startY;
		for(int i = 0; i < scores.Length; i++) {
			GameObject displayObject = alphabet.AlignedLeftWordObject(" " + names[i], namePixelWidth);
			displayObject.transform.parent = highScoresHolder.transform;
			displayObject.transform.localPosition = new Vector3(startX, currentY, 0);
			displayObject = alphabet.CenteredWordObject(" . . . . . . . . . . . . . . . . . . . . . . . . . . ", centerSpacing);
			displayObject.transform.parent = highScoresHolder.transform;
			float cx = startX + ((float) namePixelWidth) / 100;
			displayObject.transform.localPosition = new Vector3(cx, currentY, 0);
			displayObject = alphabet.AlignedRightWordObject(scores[i].ToString(), scorePixelWidth);
			displayObject.transform.parent = highScoresHolder.transform;
			cx += ((float) centerSpacing) / 100;
			displayObject.transform.localPosition = new Vector3(cx, currentY, 0);
			currentY -= spacing;
		}
	}
	
	void clearChildren() {
		foreach(Transform child in highScoresHolder.transform)
		{
			Destroy(child.gameObject);
		}
	}

    // Update is called once per frame
    void Update()
    {
        if(selectButtonPressed())
			sceneController.transitionTo("Menu");
    }
	
	bool selectButtonPressed() {
		if(Input.GetButtonDown("Jump"))
			return true;
		
		return Input.GetAxisRaw("Fire1") > 0;
	}
	
	public bool isHighScore(int score) {
		return scores[scores.Length - 1] < score;
	}
	
	public bool addHighScore(int score) {
		if(!isHighScore(score))
			return false;
		
		int index = highScoreIndex(score);
		for(int scoreIndex = scores.Length - 2; scoreIndex >= index; scoreIndex--) {
			scores[scoreIndex + 1] = scores[scoreIndex];
			names[scoreIndex + 1] = names[scoreIndex];
		}
		
		scores[index] = score;
		names[index] = "";
		buildScoresDisplay();
		GameObject ScrollInput
		return true;
	}
	
	public int highScoreIndex(int score) {
		int index = scores.Length - 1;
		while(score > scores[index] && index >= 0) {
			index--;
		}
		
		return index + 1;
	}
}
